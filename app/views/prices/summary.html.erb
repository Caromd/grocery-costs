<p id="alert"><%= alert %></p>

<%= form_tag(summary_path, method: :get) do %>
  <p>
    <%= label_tag 'Month' %>
    <%= number_field_tag 'month', Time.now.month.to_s, min: '1' ,  max: '12' %>
    <%= label_tag 'Year' %>
    <%= number_field_tag 'year', Time.now.year.to_s, min: (Time.now.year - 2).to_s, max: Time.now.year.to_s %>
    <%= submit_tag "Summarise", :name => nil %>
  </p>
<% end %>

<h1 class="index_title">MONTHLY SUMMARY FOR <%= params[:month] %> <%= params[:year] %></h1>

<% if params[:month] != nil && params[:month] != "" %>
<table>
  <tbody>
    <% grand_total = 0 %>
    <% @types.each do |type| %>
      <% type_subtotal = 0 %>
      <% @items.each do |item| %>
        <% item_subtotal = 0 %>
         <% @prices.each do |price| %>
            <% item_subtotal += price.amount if price.item_id == item.id %>
         <% end %> 
         <% if item_subtotal != 0 && item.type_id == type.id %>
          <tr>
            <td ><%= item.name %></td>
            <td id=amount><%= number_with_precision(item_subtotal, precision: 2) %></td>
            <% type_subtotal += item_subtotal if item.type_id == type.id %>
          </tr>
        <% end %>
      <% end %>
        <tr id="type_total", class="total_box">
          <td><%= type.name.upcase %></td>
          <td id=amount><%= number_with_precision(type_subtotal, precision: 2) %></td>
          <% grand_total += type_subtotal %>
        </tr>
    <% end %>        
    <tr id=grand_total>
      <td><%= 'MONTH TOTAL:' %></td>
      <td id=amount><%= number_with_precision(grand_total, precision: 2) %></td>
    </tr>
    
  </tbody>
</table>
<% end %>
<br>
